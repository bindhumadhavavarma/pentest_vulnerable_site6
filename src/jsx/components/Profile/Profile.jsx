import React, { useEffect, useState } from 'react'
import { ScaleLoader } from "react-spinners";
import { AxiosPost } from '../../../context/UserContext';
import { pushNotify } from '../../../services/NotifyService';

function Profile() {
  const [isLoading, setIsLoading] = useState(false)
  const [user, setUser] = useState({ user_name: '', email: '' })
  const [formData, setFormData] = useState({ cur_user:user.user_name,user_name: user.user_name, email: user.email })
  const [editaccount, setEditAccount] = useState(false)

  const onChangeHandler = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value })
  }

  const fetchUser = async () => {
    try {
      setIsLoading(true)
      const data = await AxiosPost('get_account_data.php');
      console.log(data);
      if (data.success) {
        setUser(data.user);
      }
      else {
        pushNotify("error", "Error", data.error);
      }
    }
    catch (err) {
      console.log(err)
      pushNotify("error", "Error", "Server Error!");
    } finally {
      setIsLoading(false)
    }
  }

  const editAccount = async () => {
    try {
      setIsLoading(true)
      const data = await AxiosPost('edit_account.php',formData);
      console.log(data);
      if (data.success) {
        pushNotify("success","success","Edited successfully")
        fetchUser()
        setEditAccount(false)
      }
      else {
        pushNotify("error", "Error", data.error);
      }
    }
    catch (err) {
      console.log(err)
      pushNotify("error", "Error", "Server Error!");
    } finally {
      setIsLoading(false)
    }
  }

  useEffect(() => {
    fetchUser()
  }, [])

  return (
    <>
      <div className="col-xl-12 col-lg-12 col-xxl-12 col-sm-12">
        {!editaccount ? null : (
          <div className='card'>
            <div className='card-header'>
              <div className='card-title'>Edit Account<button className='btn btn-cross' onClick={() => setEditAccount(false)}><i class="fas fa-times"></i></button></div>

            </div>
            <div className='card-body'>
              <div className='col-md-8 row' style={{ fontSize: "16px" }}>
                <div className='col-md-6' style={{ fontWeight: "bold" }}>User Name : </div>
                <div className='col-md-6'>
                  <input type="text" className='form-control' name="user_name" value={formData.user_name} onChange={onChangeHandler} />
                </div>
              </div>
              <div className='col-md-8 row' style={{ fontSize: "16px" }}>
                <div className='col-md-6' style={{ fontWeight: "bold" }}>Email : </div>
                <div className='col-md-6'>
                  <input type="text" className='form-control' name="email" value={formData.email} onChange={onChangeHandler} />
                </div>
                <button className='btn btn-primary' onClick={editAccount}>Edit</button>
              </div>
            </div>
          </div>
        )}
        <div className="card" style={{ "height": "fit-content" }}>
          <div className="card-header border-0 pb-0">
            <h4 className="card-title">Profile <button className='btn btn-cross' onClick={() => { setEditAccount(true); setFormData({...user,cur_user:user.user_name}) }}><i class="fas fa-edit"></i></button></h4>
          </div>
          <div className="card-body">
            {isLoading || user == null ?
              <div className="row mx-0" style={{ height: "100%" }}><ScaleLoader cssOverride={{ "display": "flex", "justifyContent": "center", "alignItems": "center" }} /></div> :
              <div className='row'>
                <div className='col-md-4'>
                  <div className="image-bx">
                    <img className="rounded-circle" src={"https://ui-avatars.com/api/?name=" + user.user_name + "&background=random&color=000000&format=svg"} width={100} alt="" />
                  </div>
                </div>
                <div className='col-md-8 row' style={{ fontSize: "16px" }}>
                  <div className='col-md-6' style={{ fontWeight: "bold" }}>User Name : </div>
                  <div className='col-md-6' dangerouslySetInnerHTML={{ __html: user.user_name }} />
                  <div className='col-md-6' style={{ fontWeight: "bold" }}>Email : </div>
                  <div className='col-md-6' dangerouslySetInnerHTML={{ __html: user.email }} />
                  <div className='col-md-6' style={{ fontWeight: "bold" }}>Privilege : </div>
                  <div className='col-md-6' dangerouslySetInnerHTML={{ __html: user.privilege }} />
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </>
  )
}

export default Profile